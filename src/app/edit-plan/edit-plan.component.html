<div class="page-container">
  <mat-toolbar color="primary" class="toolBar">
    <span class="example-toolbar-title">Meditrack</span>

    <button mat-icon-button color="link" (click)="goToHome()" >
      <mat-icon>home</mat-icon>
    </button>
  </mat-toolbar>

  <div class="container">
    <div class="row">
      <h1>Informazioni generali del piano</h1>
      <form (ngSubmit)="saveGeneralInfo()">
      <div class="form-group">
        <mat-form-field >
          <mat-label>Plan Name:</mat-label>
          <input matInput type="text" class="form-control" placeholder="Inserisci Plan Name" id="planName" name="planName" required [(ngModel)]="planData.name" [value]="plan.name">
        </mat-form-field>
        <mat-form-field >
          <mat-label>Length in days:</mat-label>
          <input matInput type="number" class="form-control" placeholder="Inserisci Plan's lenght " id="planLength" name="planLength" required [(ngModel)]="planData.planLength" [value]="plan.length">
        </mat-form-field>
        <mat-form-field >
          <mat-label>Tipo Di Piano Teraupetico</mat-label>
          <input matInput type="text" class="form-control" placeholder="Inserisci Tipo Piano " id="planType" name="planType" required [(ngModel)]="planData.type" [value]="plan.type">
        </mat-form-field>
      </div>

      <button mat-raised-button type="submit" color="primary">Update plan</button>
    </form>

      <div class="table-container">
        <h2> Medicine nel piano </h2>
        <table mat-table  [dataSource]="plan.medicines">

          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> ID </th>
            <td mat-cell *matCellDef="let medicine"> {{ medicine.id }} </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let medicine"> {{ medicine.name }} </td>
          </ng-container>

          <ng-container matColumnDef="dosage">
            <th mat-header-cell *matHeaderCellDef> Dosage </th>
            <td mat-cell *matCellDef="let medicine"> {{ medicine.dosage }} </td>
          </ng-container>

          <ng-container matColumnDef="manufacturer">
            <th mat-header-cell *matHeaderCellDef> Manufacturer </th>
            <td mat-cell *matCellDef="let medicine"> {{ medicine.manufacturer }} </td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let medicine">
             <button mat-raised-button (click)="removeMedicine(medicine)" color="warn">Delete</button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="medicineColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: medicineColumns;"></tr>
        </table>
      </div>

      <button mat-raised-button color ="primary" class="btn btn-success mr-2" (click)="updatePlan()">Update medicines</button>

      <h2>Ricerca e informazioni medicinale</h2>

      <mat-form-field>
        <input matInput type="text" placeholder="Search Medicine" name="searchText" #searchBox>
      </mat-form-field>

      <button mat-raised-button color ="primary" class="btn btn-success mr-2" (click)="searchMedicine(searchBox.value)">Search</button>

      <div *ngIf="searchResults != null">
        <div *ngFor="let med of searchResults" [attr.id]="'r' + med.id" class="d-flex flex-wrap">

          <mat-card class="example-card">
            <mat-card-subtitle> {{med.name}} </mat-card-subtitle>
            <mat-card-content>

              <p> Name : {{med.name}}</p>
              <p> Dosage: {{med.dosage}}</p>
              <p> Manufacturer : {{med.manufacturer}}</p>

              <mat-divider></mat-divider>
            </mat-card-content>
            <mat-card-actions>
              <button mat-raised-button color ="primary" class="btn btn-success mr-2" (click)="addMedicineToPlan(med)">Add medicine</button>
            </mat-card-actions>
          </mat-card>
        </div>
      </div>

    </div>
  </div>
</div>
